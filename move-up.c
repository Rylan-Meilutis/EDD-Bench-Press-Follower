#pragma config(Sensor, dgtl8, sonar, sensorSONAR_inch)
#pragma config(Motor, port2, m1, tmotorServoContinuousRotation, openLoop)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

bool moveUp = false;
float sv = 0;
float oldValue = 0;
int count = 0;
float delays = 5;
float distance = 2;
float gap = 6;
float deadBand = 0.5;
float motorSpeed = 80;
float lowMotorSpeed = 5;
int a = 0;
int state = 0;

task up () {
    while (true) {
        a++;
        if (sv < oldValue + 0.8 && sv > oldValue + 0.8) {
            if (count >= 5) {
                moveUp = true;
            } else {
                count++;
                sleep(delays / 5);
            }
        } else {
            moveUp = false;
            oldValue = sv;
            count = 0;
        }
    }
}

task drive () {
    while (true) {
        sv = SensorValue[dgtl8];
        if (moveUp) {
            startMotor(m1, lowMotorSpeed);
        } else {
            if (sv != -1 && sv < gap) {
                motorSpeed = sv / distance * 100;
                if (sv > distance + deadBand) {
                    startMotor(m1, 80);
                    state = 1;
                } else if (sv < distance - deadBand) {
                    startMotor(m1, -80);
                    state = -1;
                } else {
                    stopMotor(m1);
                    state = 0;
                }
            }
        }
    }
}

task main () {
    startTask(up);
    startTask(drive);
    while (true) {

    }
}
